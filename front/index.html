<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GreenHouse Connect - Serre Connectée Intelligente</title>
    <link rel="stylesheet" href="/front/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
</head>
<script>
async function checkAuth() {
    const token = localStorage.getItem("token");

    if (!token) {
        window.location.href = "front/login.html";
        return;
    }

    try {
        const response = await fetch("http://172.29.16.154/api/temp", {
            method: "GET",
            headers: {
                "Authorization": "Bearer " + token
            }
        });

        if (response.status === 401) {
            localStorage.removeItem("token");
            window.location.href = "/front/login.html";
        }
    } catch (err) {
        localStorage.removeItem("token");
        window.location.href = "/front/login.html";
    }
}

checkAuth();
</script>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                    <path d="M20 5C20 5 10 10 10 20C10 25 12 28 15 30C12 28 10 25 10 20C10 15 15 12 20 10C25 12 30 15 30 20C30 25 28 28 25 30C28 28 30 25 30 20C30 10 20 5 20 5Z" fill="#4CAF50"/>
                    <circle cx="20" cy="32" r="3" fill="#8BC34A"/>
                </svg>
                <span class="logo-text">GreenHouse</span>
            </div>
            <ul class="nav-links">
                <li><a href="#dashboard" class="nav-link active">Dashboard</a></li>
                <li><a href="#monitoring" class="nav-link">Surveillance</a></li>
                <li><a href="#controls" class="nav-link">Contrôles</a></li>
                <li><a href="#history" class="nav-link">Historique</a></li>
                <li><a href="#settings" class="nav-link">Paramètres</a></li>
            </ul>
            <div class="nav-status">
                <span class="status-indicator online"></span>
                <span class="status-text">Connecté</span>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1 class="hero-title">Votre Serre Connectée</h1>
            <p class="hero-subtitle">Surveillez et contrôlez votre environnement de culture en temps réel</p>
            <div class="hero-stats">
                <div class="hero-stat">
                    <span class="stat-value" id="hero-temp">--</span>
                    <span class="stat-label">Température</span>
                </div>
                <div class="hero-stat">
                    <span class="stat-value" id="hero-humidity">--</span>
                    <span class="stat-label">Humidité</span>
                </div>
            </div>
        </div>
        <div class="hero-background">
            <div class="leaf-animation leaf-1"></div>
            <div class="leaf-animation leaf-2"></div>
            <div class="leaf-animation leaf-3"></div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="container">
        <!-- Quick Status Cards -->
        <section class="quick-status">
            <div class="status-card temperature-card">
                <div class="card-icon">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                        <rect x="12" y="4" width="8" height="18" rx="1" stroke="currentColor" stroke-width="2"/>
                        <circle cx="16" cy="25" r="4" fill="currentColor"/>
                        <line x1="16" y1="8" x2="16" y2="21" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </div>
                <div class="card-content">
                    <h3 class="card-title">Température</h3>
                    <p class="card-value" id="temp-value">--°C</p>
                    <p class="card-status" id="temp-status">Chargement...</p>
                </div>
                <div class="card-chart" id="temp-chart"></div>
            </div>

            <div class="status-card humidity-card">
                <div class="card-icon">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                        <path d="M16 4C16 4 8 14 8 20C8 24.4 11.6 28 16 28C20.4 28 24 24.4 24 20C24 14 16 4 16 4Z" stroke="currentColor" stroke-width="2" fill="currentColor" opacity="0.3"/>
                    </svg>
                </div>
                <div class="card-content">
                    <h3 class="card-title">Humidité</h3>
                    <p class="card-value" id="humidity-value">--%</p>
                    <p class="card-status" id="humidity-status">Chargement...</p>
                </div>
                <div class="card-chart" id="humidity-chart"></div>
            </div>

            <div class="status-card soil-card">
                <div class="card-icon">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                        <rect x="4" y="18" width="24" height="10" rx="2" fill="currentColor" opacity="0.3"/>
                        <path d="M16 4L14 10L16 16L18 10L16 4Z" fill="currentColor"/>
                        <circle cx="10" cy="23" r="2" fill="currentColor"/>
                        <circle cx="22" cy="23" r="2" fill="currentColor"/>
                    </svg>
                </div>
                <div class="card-content">
                    <h3 class="card-title">Humidité air</h3>
                    <p class="card-value" id="soil-value">--%</p>
                    <p class="card-status" id="soil-status">Chargement...</p>
                </div>
                <div class="card-chart" id="soil-chart"></div>
            </div>

            <div class="status-card water-card" style="border-left: 4px solid #03A9F4;">
                <div class="card-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#03A9F4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2.69l5.74 5.74c.84.84 1.26 1.84 1.26 2.87A8.13 8.13 0 0 1 12 18.5a8.13 8.13 0 0 1-7-7.2c0-1.03.42-2.03 1.26-2.87L12 2.69z"/>
                    </svg>
                </div>
                <div class="card-content">
                    <h3 class="card-title">Conso. Eau</h3>
                    <p class="card-value" id="valeur-conso">-- L</p>
                    <p class="card-status">Total cumulé</p>
                </div>
            </div>

            <div class="status-card tank-card" style="border-left: 4px solid #607D8B;">
                <div class="card-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#607D8B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M2 10h20"/>
                        <path d="M4 10v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V10"/>
                        <path d="M12 4v6"/>
                        <path d="M8 6h8"/>
                    </svg>
                </div>
                <div class="card-content">
                    <h3 class="card-title">État Cuve</h3>
                    <span id="etat-cuve" class="badge" style="display:inline-block; padding: 5px 10px; border-radius: 15px; background: #eee; font-weight:bold; font-size: 0.9em;">--</span>
                    <p class="card-status" style="margin-top:5px;">Capteur Niveau</p>
                </div>
            </div>

            <div class="status-card network-card" style="border-left: 4px solid #FF9800;">
                <div class="card-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#FF9800" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M22 12h-6l-2-2H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6z"/>
                        <path d="M6 10V6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v4"/>
                    </svg>
                </div>
                <div class="card-content">
                    <h3 class="card-title">Réseau Actif</h3>
                    <strong id="etat-reseau" style="font-size: 1em; color: #333;">--</strong>
                    <p class="card-status">Source d'eau</p>
                </div>
            </div>
        </section>

        <!-- Controls Section -->
        <section class="controls-section" id="controls">
            <h2 class="section-title">Contrôles Automatiques</h2>
            <div class="controls-grid">
                <div class="control-panel">
                    <div class="control-header">
                        <h3>Arrosage Automatique</h3>
                    </div>
                    <div class="control-body">
                        <div class="toggle-switch">
                            <input type="checkbox" id="irrigation-toggle" class="toggle-input">
                            <label for="irrigation-toggle" class="toggle-label"></label>
                            <span class="toggle-label-text">Actif</span>
                        </div>
                        <div class="control-settings">
                            <label class="settings-label">Seuil: <span id="irrigation-threshold">30</span>%</label>
                            <input type="range" id="irrigation-slider" min="0" max="100" value="30" class="slider">
                        </div>
                    </div>
                </div>

                <div class="control-panel">
                    <div class="control-header">
                        <h3>Brumisateur</h3>
                    </div>
                    <div class="control-body">
                        <div class="toggle-switch">
                            <input type="checkbox" id="mist-toggle" class="toggle-input">
                            <label for="mist-toggle" class="toggle-label"></label>
                            <span class="toggle-label-text">Actif</span>
                        </div>
                        <div class="control-settings">
                            <label class="settings-label">Intensité: <span id="mist-intensity">50</span>%</label>
                            <input type="range" id="mist-slider" min="0" max="100" value="50" class="slider">
                        </div>
                    </div>
                </div>

                <div class="control-panel">
                    <div class="control-header">
                        <h3>Ventilation</h3>
                    </div>
                    <div class="control-body">
                        <div class="toggle-switch">
                            <input type="checkbox" id="ventilation-toggle" class="toggle-input">
                            <label for="ventilation-toggle" class="toggle-label"></label>
                            <span class="toggle-label-text">Actif</span>
                        </div>
                        <div class="control-settings">
                            <label class="settings-label">Vitesse: <span id="ventilation-speed">3</span>/5</label>
                            <input type="range" id="ventilation-slider" min="1" max="5" value="3" class="slider">
                        </div>
                    </div>
                </div>

                <div class="control-panel">
                    <div class="control-header">
                        <h3>Chauffage</h3>
                    </div>
                    <div class="control-body">
                        <div class="toggle-switch">
                            <input type="checkbox" id="heating-toggle" class="toggle-input">
                            <label for="heating-toggle" class="toggle-label"></label>
                            <span class="toggle-label-text">Actif</span>
                        </div>
                        <div class="control-settings">
                            <label class="settings-label">Température: <span id="heating-target">20</span>°C</label>
                            <input type="range" id="heating-slider" min="10" max="35" value="20" class="slider">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bouton Appliquer -->
            <div class="controls-footer">
                <button id="apply-controls-btn" class="btn-apply">
                    <span class="btn-icon">✓</span> Appliquer les paramètres
                </button>
            </div>
        </section>

        <!-- Charts Section -->
        <section class="charts-section">
            <h2 class="section-title">Évolution des Données (24h)</h2>
            <div class="charts-grid">
                <div class="chart-container">
                    <h3 class="chart-title">Température & Humidité</h3>
                    <canvas id="temp-humidity-chart"></canvas>
                </div>
                <div class="chart-container">
                    <h3 class="chart-title">Luminosité & Humidité Sol</h3>
                    <canvas id="light-soil-chart"></canvas>
                </div>
            </div>
        </section>

        <!-- Alerts Section -->
        <section class="alerts-section">
            <h2 class="section-title">Alertes & Notifications</h2>
            <div class="alerts-container" id="alerts-container">
                <div class="alert alert-info">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
                        <line x1="10" y1="6" x2="10" y2="10" stroke="currentColor" stroke-width="2"/>
                        <circle cx="10" cy="13" r="1" fill="currentColor"/>
                    </svg>
                    <div class="alert-content">
                        <h4>Système initialisé</h4>
                        <p>Connexion établie avec les capteurs de la serre</p>
                        <span class="alert-time">Il y a quelques instants</span>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>GreenHouse Connect</h4>
                <p>Solution intelligente de gestion de serre</p>
            </div>
            <div class="footer-section">
                <h4>Projet BTS</h4>
                <p>Système de surveillance et contrôle automatisé</p>
            </div>
            <div class="footer-section">
                <h4>Statut</h4>
                <p id="footer-status">Tous les systèmes opérationnels</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 GreenHouse Connect - Tous droits réservés à Ryan-Jonas-Raphael-Sacha</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="/front/script.js"></script>
</body>
</html>